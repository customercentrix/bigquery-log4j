<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Bigquery-log4j2 by customercentrix</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Bigquery-log4j2</h1>
        <h2></h2>
        <a href="https://github.com/customercentrix/bigquery-log4j2" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2>
<a name="about" class="anchor" href="#about"><span class="octicon octicon-link"></span></a>About</h2>

<p>Bigquery-Log4j2 is a Java project for streaming logs to BigQuery. It uses Log4j to define the BigQueryAppender that processes the log messages.</p>

<h2>
<a name="setting-up" class="anchor" href="#setting-up"><span class="octicon octicon-link"></span></a>Setting Up</h2>

<p>Before you start you need to make the following changes:</p>

<ol>
<li><p>Open <code>BigQueryUtils.java</code> and change the <code>DATASET_ID</code>, <code>PROJECT_ID</code>, and <code>SERVICE_ACCOUNT_EMAIL</code> to your projects value.</p></li>
<li><p>Generate a <code>key.p12</code> file from within the Google Developer console.</p></li>
<li><p>Place the <code>key.p12</code> file inside of the <code>bigquery-log4j</code> folder.</p></li>
</ol><h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>The simplest way to verify Bigquery and Log4j2 are working is to run the <code>Log4jTests.java</code> unit test. If the test completes successfully then you can visit the BigQuery console and run queries. </p>

<p>Follow the steps below to start streaming log messages from your project:</p>

<ol>
<li>
<p>Configure your project to use <a href="http://logging.apache.org/log4j/2.x/">Log4j2</a> by adding the appropriate jars</p>

<p>a. Maven Dependencies for Log4j2 </p>

<pre><code>  &lt;dependency&gt;    
      &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;
      &lt;version&gt;2.0.1&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
      &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
      &lt;artifactId&gt;log4j-core&lt;/artifactId&gt;
      &lt;version&gt;2.0.1&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>Copy the <code>log4j2.xml</code> file into the source folder or enter the following values into your own version:</p>

<p>a. Within <code>&lt;Apenders&gt;</code> enter</p>

<pre><code>  &lt;BigQueryAppender name="BIGQUERY"&gt;        
  &lt;/BigQueryAppender&gt;
</code></pre>

<p>b. Within <code>&lt;Loggers&gt;</code> enter. View <a href="http://logging.apache.org/log4j/2.x/manual/architecture.html#LoggerConfig">Logger Levels</a> for more info.</p>

<pre><code>  &lt;Root level="DEBUG"&gt;
      &lt;AppenderRef ref="BIGQUERY" /&gt;
  &lt;/Root&gt;
</code></pre>
</li>
<li><p>Add the <code>BigQueryAppender.java</code> to your project.</p></li>
<li><p>Now you can start logging by calling <code>LogManager.getLogger(CURRENT_CLASS.class);</code> to retrieve the logger.</p></li>
</ol><h2>
<a name="troubleshooting" class="anchor" href="#troubleshooting"><span class="octicon octicon-link"></span></a>Troubleshooting</h2>

<p>If your logs are not being sent and/or there are BigQuery exceptions then there is a good chance your table has not been setup correctly. The easiest way to fix this is to run <code>BigQueryRefresher.java</code> which will delete the table and recreate it.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/customercentrix/bigquery-log4j2/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/customercentrix/bigquery-log4j2/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/customercentrix/bigquery-log4j2"></a> is maintained by <a href="https://github.com/customercentrix">customercentrix</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>